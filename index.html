<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Ø¨Ø±Ø¯Ø§Ø´Øª Ú©Ø§Ù„Ø¨Ø¯ÛŒ Ø´Ù‡Ø± Ø¯Ø§ÙˆØ±Ø²Ù†</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.9.2/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.9.2/mapbox-gl.js"></script>
    <style>
        body {
            font-family: 'Vazir', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }

        .box {
            background-color: #ffffff;
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            padding: 10px;
            text-align: center;
            margin: 10px;
        }

        .box h1 {
            font-size: 22px;
            color: #333;
            margin: 0;
        }

        #map {
            position: relative;
            width: 100%;
            height: calc(100vh - 120px); /* Ø§Ø±ØªÙØ§Ø¹ Ù†Ù‚Ø´Ù‡ */
        }

        #layerControl {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 1;
            font-size: 14px;
        }

        /* ÙˆØ§Ú©Ù†Ø´â€ŒÚ¯Ø±Ø§ÛŒÛŒ */
        @media (max-width: 600px) {
            .box h1 {
                font-size: 18px;
            }

            #layerControl {
                font-size: 12px;
                padding: 8px;
            }

            #map {
                height: calc(100vh - 100px);
            }
        }
    </style>
</head>
<body>
    <div class="box">
        <h1>Ø¨Ø±Ø¯Ø§Ø´Øª Ú©Ø§Ù„Ø¨Ø¯ÛŒ Ø´Ù‡Ø± Ø¯Ø§ÙˆØ±Ø²Ù†</h1>
    </div>

    <div id="layerControl">
        <label><input type="checkbox" id="ayan" checked> Ø§Ø¹ÛŒØ§Ù†</label><br>
        <label><input type="checkbox" id="arse" checked> Ø¹Ø±ØµÙ‡</label><br>
        <label><input type="checkbox" id="photo" checked> Ø¹Ú©Ø³ Ù‡ÙˆØ§ÛŒÛŒ</label>
    </div>

    <div id="map"></div>
    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoiamF2YWRyaWdpIiwiYSI6ImNsNHY1YmNrMTE2dGszam51cG55c3J6bDgifQ.nhodllum999UBo_qE_jKiw';
        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/javadrigi/cm2hjvlwo014701pi7zvw52jf',
            center: [56.8748, 36.3519],
            zoom: 15
        });

        // Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ù†Ù‚Ø´Ù‡
        map.addControl(new mapboxgl.NavigationControl());
        const geolocateControl = new mapboxgl.GeolocateControl({
            positionOptions: { enableHighAccuracy: true },
            trackUserLocation: true,
            showUserHeading: true
        });
        map.addControl(geolocateControl);

        // ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø³ØªÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ
        map.on('load', () => {
            geolocateControl.on('geolocate', (position) => {
                console.log('User location:', position.coords);
            });
            geolocateControl.trigger();
        });

        // Ù…Ø¯ÛŒØ±ÛŒØª Ù„Ø§ÛŒÙ‡â€ŒÙ‡Ø§
        map.on('load', function () {
            const layers = {
                ayan: 'ayan',
                arse: 'arse',
                photo: 'photo'
            };

            Object.keys(layers).forEach((id) => {
                const checkbox = document.getElementById(id);
                checkbox.addEventListener('change', function () {
                    map.setLayoutProperty(
                        layers[id],
                        'visibility',
                        this.checked ? 'visible' : 'none'
                    );
                });
            });

  // ØªØ¹Ø±ÛŒÙ Ú©Ù„Ø§Ø³ ResetCenterControl
    class ResetCenterControl {
        onAdd(map) {
            this.map = map;

            // Ø³Ø§Ø®Øª Ø¯Ú©Ù…Ù‡
            this.container = document.createElement('button');
            this.container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';
            this.container.style.cursor = 'pointer';
            this.container.title = 'Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ø±Ú©Ø²';
            this.container.innerHTML = 'ğŸ”„'; // ÛŒØ§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø¢ÛŒÚ©ÙˆÙ† SVG

            // ØªØ¹Ø±ÛŒÙ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ú©Ù„ÛŒÚ©
            this.container.onclick = () => {
                const initialCenter = [56.8748, 36.3519];
                const initialZoom = 15;

                map.flyTo({
                    center: initialCenter,
                    zoom: initialZoom,
                    essential: true
                });
            };

            return this.container;
        }

        onRemove() {
            this.container.parentNode.removeChild(this.container);
            this.map = undefined;
        }
    }

    // Ø§ÙØ²ÙˆØ¯Ù† Ú©Ù†ØªØ±Ù„ Ø¨Ù‡ Ù†Ù‚Ø´Ù‡
    map.addControl(new ResetCenterControl(), 'top-right');
            // Ø§ÙØ²ÙˆØ¯Ù† Ù‚Ø§Ø¨Ù„ÛŒØª Identify (Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡ Ùˆ Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª)
            map.on('click', function (e) {
                const features = map.queryRenderedFeatures(e.point);

                if (features.length) {
                    const feature = features[0];

                    new mapboxgl.Popup()
                        .setLngLat(e.lngLat)
                        .setHTML(`
                            <strong>Feature ID:</strong> ${feature.id}<br>
                            <strong>Properties:</strong>
                            <pre>${JSON.stringify(feature.properties, null, 2)}</pre>
                        `)
                        .addTo(map);
                } else {
                    console.log('Ù‡ÛŒÚ† ÙˆÛŒÚ˜Ú¯ÛŒ Ø¯Ø± Ø§ÛŒÙ† Ù†Ù‚Ø·Ù‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.');
                }
            });
        });
		
    </script>
</body>
</html>
